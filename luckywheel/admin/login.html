<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>5G88 Admin Login</title>
<link rel="stylesheet" href="./assest.css">
<style>
  /* tambah style khas login (tak kacau css utama) */
  body{
    background: radial-gradient(900px 600px at 20% 10%, rgba(22, 104, 220, .35), transparent 60%), radial-gradient(900px 600px at 80% 30%, transparent 60%), linear-gradient(180deg, #070A16, #000 60%, #0E1B4E);
    display:grid;
    place-items:center;
    padding:24px;
  }
  .loginWrap{width:min(420px,100%); display:block;}
  @media (max-width: 860px){ .loginWrap{grid-template-columns:1fr} }

  .loginCard{
    background: rgba(0, 0, 0, .06);
    border:1px solid rgba(255,255,255,.12);
    border-radius:12px;
    box-shadow:0 18px 50px rgba(0,0,0,.35);
    backdrop-filter: blur(12px);
    overflow:hidden;
    padding:18px;
  }
  
  .loginCard{padding:18px}
  .where-style{margin:0 0 6px;text-align:center;padding: 10px;font-size: 25px;}
  .brandRow{display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:.5px}
  .dot{width:12px;height:12px;border-radius:999px;background:linear-gradient(90deg,var(--gold1),var(--gold2))}
  .hero h1{margin:10px 0 8px;font-size:28px}
  .hero p{margin:0;color:var(--muted);line-height:1.5}
  .chips{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px}
  .chip{padding:8px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.14);background:rgba(0,0,0,.18);font-size:12px;color:rgba(233,236,255,.86)}
  .btn{margin-top:10px}
  .hint{margin-top:10px;color:var(--muted);font-size:12px;line-height:1.4}
  /* ✅ Toast center */
/* ✅ Toast bottom-center (kecil macam contoh) */
#toast.toast{
  position: fixed !important;
  left: 50% !important;
  bottom: 28px !important;
  top: auto !important;
  right: auto !important;
  transform: translateX(-50%) !important;

  display: inline-flex !important;
  align-items: center;
  justify-content: center;
  gap: 10px;

  width: auto !important;
  height: auto !important;
  min-width: auto !important;
  max-width: min(520px, calc(100vw - 32px)) !important;

  padding: 10px 14px !important;
  border-radius: 12px !important;

  background: rgba(10,12,16,.92) !important;
  border: 1px solid rgba(255,255,255,.14) !important;
  color: #fff !important;

  box-shadow: 0 14px 40px rgba(0,0,0,.45) !important;
  backdrop-filter: blur(10px);

  opacity: 0;
  pointer-events: none;
  z-index: 999999 !important;
}
#toast.toast.show{
  opacity: 1;
  pointer-events: auto;
  animation: toastUp .18s ease-out;
}
@keyframes toastUp{
  from{ transform: translateX(-50%) translateY(8px); opacity: .2; }
  to{ transform: translateX(-50%) translateY(0); opacity: 1; }
}
</style>
</head>
<body>

<div class="loginWrap">
  <div class="loginCard">
    <h3 class="where-style">Login</h3>
    <div class="body" style="padding:0;">
      <label>Username</label>
      <input id="uid"autocomplete="username">
      <label>Password</label>
      <input id="pw" type="password" placeholder="******" autocomplete="current-password">
      <button class="btn" id="btnLogin">Login</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAuth, setPersistence, browserLocalPersistence, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDSqpbnkb3GLNFlHLYSz5XyRYPvKLAOCOA",
    authDomain: "lucky-spined.firebaseapp.com",
    databaseURL: "https://lucky-spined-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "lucky-spined",
    storageBucket: "lucky-spined.firebasestorage.app",
    messagingSenderId: "708886212396",
    appId: "1:708886212396:web:2cb7a900fe1a7891510689"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  const $ = (id)=>document.getElementById(id);
  function setLoginButton(state){
  const btn = $("btnLogin");

  if(state === "idle"){
    btn.disabled = false;
    btn.textContent = "Login";
  }

  if(state === "loading"){
    btn.disabled = true;
    btn.textContent = "Logging in...";
  }

  if(state === "success"){
    btn.disabled = true;
    btn.textContent = "Logged in ✓";
  }
}
function toast(msg){
  const t = $("toast");
  t.textContent = msg;
  t.classList.add("show");
  clearTimeout(window.__t);
  window.__t = setTimeout(()=> t.classList.remove("show"), 2200);
}

  function toAdminEmail(id){
    const clean = String(id||"").trim().toLowerCase();
    return clean ? `${clean}@5g88.admin` : "";
  }

  function getRedirectTarget(){
    const u = new URL(location.href);
    return u.searchParams.get("redirect") || "https://mrprofessorr.github.io/5g88/luckywheel/admin";
  }

  async function isAllowedAdmin(uid){
    const snap = await get(ref(db, `isloading/${uid}`));
    return snap.exists() && snap.val() === true;
  }

async function doLogin(){
  const id = $("uid").value.trim();
  const pw = $("pw").value;

  if(!id || !pw){
    toast("Please enter Admin ID & Password");
    return;
  }
  setLoginButton("loading");

  try{
    await setPersistence(auth, browserLocalPersistence);

    const cred = await signInWithEmailAndPassword(
      auth,
      toAdminEmail(id),
      pw
    );

    const ok = await isAllowedAdmin(cred.user.uid);

    if(!ok){
      toast("This account is not allowed as Admin");
      await signOut(auth);
      setLoginButton("idle");
      return;
    }
    toast("Login success");
    setLoginButton("success");
    setTimeout(()=>{
      location.replace(getRedirectTarget());
    }, 600);

  }catch(err){
    toast("Login failed");
    setLoginButton("idle");
  }
}

  $("btnLogin").addEventListener("click", doLogin);
  $("pw").addEventListener("keydown", (e)=>{ if(e.key==="Enter") doLogin(); });
</script>
</body>
</html>
